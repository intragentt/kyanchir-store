# Kyanchir Store ‚Äî –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∞–ø—Ä–µ–ª—å 2025)

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- **–£—Ç–µ—á–∫–∞ cron-—Å–µ–∫—Ä–µ—Ç–∞**: —Ñ–∞–π–ª `vercel.json` —É–¥–∞–ª—ë–Ω –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è; —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Vercel Scheduler —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `CRON_SECRET`. –ü–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `docs/operations/cron.md`.„ÄêF:docs/operations/cron.md‚Ä†L1-L12„Äë
- **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π UI –∫–Ω–æ–ø–∫–∏ ¬´–í –∫–æ—Ä–∑–∏–Ω—É¬ª**: –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ñ–∏–≥ `src/config/payments.ts` –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Ç–µ—Å—Ç–æ–≤–æ–π –æ–ø–ª–∞—Ç—ã. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `NEXT_PUBLIC_TEST_PAYMENT_URL` –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –∑–∞–∫–∞–∑–∞ –ª–æ–∫–∞–ª—å–Ω–æ.„ÄêF:src/config/payments.ts‚Ä†L1-L14„Äë„ÄêF:src/components/ProductDetails.tsx‚Ä†L329-L376„Äë„ÄêF:src/components/site/product/AddToCartButton.tsx‚Ä†L33-L66„Äë
- **–û—à–∏–±–æ—á–Ω—ã–π include –≤ `tsconfig.json`**: —É–¥–∞–ª–µ–Ω–∞ –±–∏—Ç–∞—è –∑–∞–ø–∏—Å—å `route.ts.–¥tkk`, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å `tsc --noEmit`.„ÄêF:tsconfig.json‚Ä†L1-L26„Äë

## ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
| –†–∏—Å–∫ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
| --- | --- | --- |
| API `/api/admin/products/update-stock/route.ts` –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–µ–∑ retry. | üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ Server Action —Å `prisma.$transaction` –∏ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫. |
| Cron-—Å–∏–Ω–∫ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫—É—é —Å–µ—Å—Å–∏—é, —á—Ç–æ –º–µ—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á—É –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞. | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π | –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ç–æ–∫–µ–Ω –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è cron-–∑–∞–ø—É—Å–∫–æ–≤. –°–º. `docs/operations/cron.md`. |
| YooKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–ª—é—á–∏ `YOOKASSA_*`, –∞ –∫–æ–¥ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏. | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π | –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ e2e-—Ç–µ—Å—Ç –æ–ø–ª–∞—Ç—ã –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–æ–µ–≤—ã—Ö –∫–ª—é—á–µ–π. |
| –í –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–ª–µ—Ä—Ç–æ–≤. | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π | –ü–æ–¥–∫–ª—é—á–∏—Ç—å Sentry –∏–ª–∏ Logtail, —Ä–∞—Å—à–∏—Ä–∏—Ç—å `src/lib/monitoring.ts`. |

## üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ù–∏–∂–µ ‚Äî —Å—Ä–µ–∑ –ø–æ env-–∫–ª—é—á–∞–º, —É–ø–æ–º—è–Ω—É—Ç—ã–º –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ.

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
| --- | --- | --- |
| `DATABASE_URL` | ‚úÖ –ï—Å—Ç—å –≤ .env (–Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–≤—è–∑–Ω–æ—Å—Ç—å) | –¢—Ä–µ–±—É–µ—Ç –∂–∏–≤–æ–π –ë–î –¥–ª—è smoke-—Ç–µ—Å—Ç–æ–≤. |
| `EMAIL_SERVER_USER`, `EMAIL_SERVER_PASSWORD`, `EMAIL_SERVER_HOST`, `EMAIL_SERVER_PORT`, `EMAIL_FROM` | ‚úÖ –ï—Å—Ç—å | –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ—á—Ç–æ–≤—ã–π smoke-—Ç–µ—Å—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è. |
| `AUTH_SECRET`, `NEXTAUTH_URL` | ‚úÖ –ï—Å—Ç—å | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JWT –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è. |
| `NEXT_PUBLIC_TELEGRAM_BOT_USERNAME`, `TELEGRAM_BOT_USERNAME`, `TELEGRAM_BOT_TOKEN`, `TELEGRAM_WEBHOOK_SECRET` | ‚úÖ –ï—Å—Ç—å | –ù—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±—Ö—É–∫–∞ –Ω–∞ —Å—Ç–µ–π–¥–∂–∏–Ω–≥–µ. |
| `TELEGRAM_SUPPORT_BOT_TOKEN`, `TELEGRAM_SUPPORT_WEBHOOK_SECRET`, `TELEGRAM_ADMIN_IDS` | ‚úÖ –ï—Å—Ç—å | –¢—Ä–µ–±—É—é—Ç—Å—è e2e-—Ç–µ—Å—Ç—ã –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏. |
| `MOYSKLAD_API_TOKEN` | ‚úÖ –ï—Å—Ç—å | –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä—É—á–Ω–æ–π —Ç–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤. |
| `CRON_SECRET` | ‚ö†Ô∏è –ï—Å—Ç—å, –Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Vercel Scheduler. |
| `ENCRYPTION_KEY`, `ENCRYPTION_SALT` | ‚úÖ –ï—Å—Ç—å | –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –Ω–∞ —Ñ–æ—Ä–º–∞—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è unit-—Ç–µ—Å—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è. |
| `BOT_API_SECRET` | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ë–µ–∑ –Ω–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram bot API. |
| `YOOKASSA_*` (`YOOKASSA_SHOP_ID`, `YOOKASSA_SECRET_KEY`, `YOOKASSA_TEST_SHOP_ID`, `YOOKASSA_TEST_SECRET_KEY`, `YOOKASSA_MODE`, `YOOKASSA_RETURN_URL`, `YOOKASSA_RECEIPT_ENABLED`, `YOOKASSA_RECEIPT_VAT_CODE`, `YOOKASSA_TAX_SYSTEM_CODE`, `YOOKASSA_MERCHANT_FULL_NAME`, `YOOKASSA_MERCHANT_INN`) | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç | –ë–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–ø—É—Å–∫ –æ–ø–ª–∞—Ç—ã; –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∫–ª—é—á–∏ —É –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. |
| `NEXT_PUBLIC_TEST_PAYMENT_URL`, `NEXT_PUBLIC_TEST_PAYMENT_KEY`, `NEXT_PUBLIC_ENABLE_TEST_PAYMENT_REDIRECT` | ‚ö†Ô∏è –î–æ–±–∞–≤–ª–µ–Ω—ã | –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –∑–∞–¥–∞–π—Ç–µ URL –∏ –∫–ª—é—á –≤ .env. |

> ‚ÑπÔ∏è –§–∏–∑–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–ë–î, SendGrid, Telegram, YooKassa) –≤ –æ—Ñ–ª–∞–π–Ω-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞. –ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ smoke-—Ç–µ—Å—Ç—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ staging.

## üìå –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Server Action –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –∑–∞–∫—Ä—ã—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç—å –≥–æ–Ω–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö.
2. –ó–∞–≤–µ—Å—Ç–∏ —Å–µ–∫—Ä–µ—Ç `BOT_API_SECRET` –∏ –ø–æ–∫—Ä—ã—Ç—å Telegram API unit-—Ç–µ—Å—Ç–∞–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å YooKassa –∫–ª—é—á–∏ –∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å checkout –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç—ë–∂–Ω—ã–π —Ñ–ª–æ—É.
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥ (Sentry/Logtail) –∏ –æ–±–Ω–æ–≤–∏—Ç—å `src/lib/monitoring.ts`.
