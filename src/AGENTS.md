# üß† Source Agent ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–∞–ø–∫–∏ `src`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –º–∞—Ä—à—Ä—É—Ç—ã
1. **App Router**: –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–µ–∂–∞—Ç –≤ `src/app/(site)`, –∞–¥–º–∏–Ω–∫–∞ ‚Äî –≤ `src/app/admin`, API ‚Äî –≤ `src/app/api`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —ç—Ç—É —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –∏ –Ω–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ —Ä–æ–ª–∏ –≤ –æ–¥–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ.„ÄêF:src/app/(site)/page.tsx‚Ä†L1-L90„Äë„ÄêF:src/app/admin/settings/design-system/page.tsx‚Ä†L1-L74„Äë„ÄêF:src/app/api/orders/route.ts‚Ä†L1-L243„Äë
2. **–î–æ–ª–≥ –ø–æ –≤–∏—Ç—Ä–∏–Ω–µ**: —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/(site)` –ø–æ–º–µ—á–µ–Ω—ã `force-dynamic` –∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞—é—Ç –≤–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥ –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏. –õ—é–±—ã–µ –ø—Ä–∞–≤–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã –¥–æ–ª–∂–Ω—ã —Å–Ω–∏–∂–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ Prisma (–ª–∏–º–∏—Ç—ã, `unstable_cache`, —Ñ–∏–ª—å—Ç—Ä—ã).„ÄêF:src/app/(site)/page.tsx‚Ä†L8-L90„Äë„ÄêF:src/app/(site)/catalog/page.tsx‚Ä†L7-L70„Äë
3. **Server Components**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–µ–ª–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏. –ö –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º (`'use client'`) –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–¥–µ–ª—è–π—Ç–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å—Ç–æ—Ä—ã/—Ö—É–∫–∏.„ÄêF:src/app/(site)/checkout/page.tsx‚Ä†L1-L200„Äë„ÄêF:src/store/useCartStore.ts‚Ä†L1-L141„Äë

## –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏
1. **Prisma**: –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `$transaction` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤. –í API –∑–∞–∫–∞–∑–∞ —ç—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.„ÄêF:src/app/api/orders/route.ts‚Ä†L60-L166„Äë
2. **–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–ÆKassa, –ú–æ–π–°–∫–ª–∞–¥, Telegram) –ª–µ–∂–∞—Ç –≤ `src/lib`. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏—Ö —Ç–æ–ª—å–∫–æ –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –∏ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–ª–∏ env.„ÄêF:src/lib/payments/yookassa.ts‚Ä†L1-L200„Äë„ÄêF:src/lib/moysklad-api.ts‚Ä†L1-L200„Äë
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `src/lib/monitoring.ts` –∏ `src/lib/performance.ts` –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è/–º–µ—Ç—Ä–∏–∫. –ù–µ –¥—É–±–ª–∏—Ä—É–π—Ç–µ –ø—Ä—è–º—ã–µ `console.*` –≤ –±–∏–∑–Ω–µ—Å-–∫–æ–¥–µ ‚Äî –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ —ç—Ç–∏ —É—Ç–∏–ª–∏—Ç—ã –∏ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ –∏—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.„ÄêF:src/lib/monitoring.ts‚Ä†L1-L38„Äë„ÄêF:src/lib/performance.ts‚Ä†L1-L38„Äë

## –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
1. **Zustand**: —Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ—Ä–∑–∏–Ω—É –∏ UI-—Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ —Å—Ç–æ—Ä–∞—Ö –≤–Ω—É—Ç—Ä–∏ `src/store`. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å—Ç–æ—Ä–∞, –∞ –Ω–µ –¥–µ—Ä–∂–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.„ÄêF:src/store/useCartStore.ts‚Ä†L1-L141„Äë
2. **Checkout flow**: `CheckoutPage` –æ—á–∏—â–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ `POST /api/orders`. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —ç—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å API-–æ—Ç–≤–µ—Ç, –µ—Å–ª–∏ –ø–æ–ª—è –º–µ–Ω—è—é—Ç—Å—è.„ÄêF:src/app/(site)/checkout/page.tsx‚Ä†L78-L200„Äë„ÄêF:src/app/api/orders/route.ts‚Ä†L203-L243„Äë
3. **ProductDetails**: –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π —Ç–æ–≤–∞—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ç–µ—Å—Ç–æ–≤—ã–º –ø–ª–∞—Ç–µ–∂–æ–º, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å UX.„ÄêF:src/components/ProductDetails.tsx‚Ä†L329-L376„Äë

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø
1. **–ê–¥–º–∏–Ω—Å–∫–∏–µ —Ä–æ—É—Ç—ã**: –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–æ–ª—å —á–µ—Ä–µ–∑ `getServerSession` –∏ –Ω–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥. –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ `update-stock` ‚Äî –µ–≥–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–∞–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è.„ÄêF:src/app/api/admin/products/update-stock/route.ts‚Ä†L15-L53„Äë
2. **server-only**: –¥–ª—è –º–æ–¥—É–ª–µ–π —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `import 'server-only';` –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞, –∫–∞–∫ –≤ –ÆKassa-—É—Ç–∏–ª–∏—Ç–∞—Ö, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–∞–Ω–¥–ª.„ÄêF:src/lib/payments/yookassa.ts‚Ä†L1-L198„Äë
3. **–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ –æ—à–∏–±–∫–∏**: –ø—Ä–∏ –ª–æ–≤–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç (id –∑–∞–∫–∞–∑–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è) –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –≤ `logError`, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Sentry/Logtail.„ÄêF:src/lib/monitoring.ts‚Ä†L22-L34„Äë

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±–Ω–æ–≤–ª—è—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –¥–æ–ø–æ–ª–Ω—è–π—Ç–µ node:test-—Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ `tests/`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–Ω–¥–µ—Ä —á–µ—Ä–µ–∑ `react-dom/server`, –∫–∞–∫ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö, –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–ª–æ—É –∫–æ—Ä–∑–∏–Ω—ã/checkout –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ PR.„ÄêF:tests/ui-components.test.tsx‚Ä†L1-L29„Äë„ÄêF:tests/lib-utils.test.ts‚Ä†L1-L32„Äë
