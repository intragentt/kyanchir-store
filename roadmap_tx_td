# Дорожная карта Kyanchir — Q2 2025

## 1. Checkout & платежи
- **Текущий статус:** чек-аут создаёт заказ и формирует платеж YooKassa в тестовом режиме. Новый режим тестовой оплаты по кнопке "В корзину" позволяет мгновенно переходить к оплате, но требует реального платёжного провайдера для production.【F:src/components/ProductDetails.tsx†L329-L376】【F:src/config/payments.ts†L1-L14】
- **Следующие шаги:**
  1. Собрать ключи `YOOKASSA_*` и включить `YOOKASSA_MODE=live`.
  2. Покрыть чек-аут интеграционным тестом: happy-path + отказ платежа.
  3. Реализовать страницу истории заказов и уведомления (email + Telegram).

## 2. Каталог и синхронизация остатков
- **Текущий статус:** синхронизация запускается через административный API (`/api/admin/sync/products`). Cron-конфигурация вынесена из репозитория, настройка описана в `docs/operations/cron.md`. Страницы витрины всё ещё `force-dynamic` и перегружают БД.【F:docs/operations/cron.md†L1-L12】【F:src/app/(site)/page.tsx†L7-L47】
- **Следующие шаги:**
  1. Создать Server Action с `prisma.$transaction` для обновления остатков (устранить расхождение с МойСклад).【F:src/app/api/admin/products/update-stock/route.ts†L13-L54】
  2. Добавить пагинацию и кеширование (`unstable_cache` или ISR) на главной и каталоге.
  3. Включить мониторинг ошибок синхронизации в `src/lib/monitoring.ts`.

## 3. Безопасность и наблюдаемость
- **Текущий статус:** cron-секрет удалён, составлен свежий отчёт `docs/SECURITY_AUDIT.md`. `BOT_API_SECRET` и ключи YooKassa отсутствуют, мониторинг отключен.【F:docs/SECURITY_AUDIT.md†L4-L33】
- **Следующие шаги:**
  1. Завести `BOT_API_SECRET`, покрыть Telegram login unit-тестами.
  2. Подключить Sentry/Logtail через `src/lib/monitoring.ts`.
  3. Автоматизировать проверку `tsc --noEmit` в CI (ошибка include исправлена).【F:tsconfig.json†L1-L26】

## 4. Админка и UX
- **Текущий статус:** дизайн-система и редакторы фильтров работают, но некоторые компоненты остаются "god-components" без декомпозиции.
- **Следующие шаги:**
  1. Разбить `ClassificationClient.tsx` на хук и презентационный слой.
  2. Вынести иконки из локальных компонентов в `src/components/icons/`.
  3. Добавить a11y-улучшения в `NotificationManager` (ARIA-атрибуты, toast-логика).

## 5. Документация и процессы
- **Текущий статус:** README, README_KYANCHIR, AGENTS.md и STATUS.md синхронизированы с кодом; добавлен аудит безопасности и гайд по cron.
- **Следующие шаги:**
  1. Описать процедуру smoke-тестов перед релизом.
  2. Сформировать `docs/runbooks/` для критических инцидентов (оплата, синк каталога).
  3. Обновлять SECURITY_AUDIT.md после каждой ревизии секретов.
